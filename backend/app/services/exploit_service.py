from typing import Any

from .dbs.databases import get_collection


async def read_exploits_by_cve_id(cve: str) -> list[dict[str, Any]]:
    exploits_collection = get_collection("exploits")
    pipeline: Any = [
        {"$project": {
            "_id": 0,
            "id": 1,
            "href": 1,
            "type": 1,
            "sourceData": 1,
            "description": 1,
            "cvss": 1,
            "cvelist": 1
        }},
        {"$match": {"cvelist": {"$in": [cve]}}},
    ]
    try:
        return [
            exploit async for exploit in exploits_collection.aggregate(pipeline)
        ]
    except Exception as _:
        return []
